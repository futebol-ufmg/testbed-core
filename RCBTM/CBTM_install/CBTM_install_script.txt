CBTM installation script

1 - Firstly, kill any libvirtd daemon that might be running.

ps -aux | grep libvirt
sudo kill LIBVIRT_PID <insert here the PID found for libvirt when you ran the command above>

Then, make sure there is no old version of libvirt installed from the packet manager that would conflict with your source installation. You can uninstall old versions installed from apt-get by doing:

sudo apt-get purge libvirt-dev libvirt-bin libvirt0

Be wary, this will also remove configuration files. Since opennebula depends on libvirt-bin, you might have to uninstall opennebula.

To make sure everything is squeaky clean, you can run the commands below to find and then delete the appropriate files and folders. This is especially relevant if the previous version was installed from source.

<if anything shows up when you run these commands, unninstall and delete it>
find / -name libvirt 
find / -type f -name "*libvirt*"

2 - 
To install the required dependencies do the following:

sudo apt-get install gcc make pkg-config libxml2-dev libgnutls-dev libdevmapper-dev libcurl4-gnutls-dev python-dev libpciaccess-dev libxen-dev libnl-3-dev libnl-route-3-200 libnl-route-3-dev libyajl-dev uuid-dev qemu-kvm bridge-utils dnsmasq 

3 -

To start installing libvirt, firstly you will need to get the source. You do this by doing:

wget libvirt.org/sources/libvirt-1.3.4.tar.gz
tar -xzf libvirt-1.3.4.tar.gz

4 - 
After getting the source, do the following to install libvirt:

cd libvirt-1.3.4
./autogen.sh --system
make
sudo make install
sudo ldconfig

5 - Create group "libvirtd"
sudo groupadd libvirtd

6 - To be able to use libvirt without sudo, you will need to add yourself to the libvirtd group:

sudo adduser `id -un` libvirtd

7 - Read the following:

After this, you will also need to change the libvirt and qemu configuration files.

    On /etc/libvirt/libvirtd.conf, change the following lines

unix_sock_group = "libvirtd"
unix_sock_rw_perms = "0770"
auth_unix_ro = "none"
auth_unix_rw = "none"

    On /etc/libvirt/qemu.conf, change the following line

stdio_handler = "file"

After changing the configuration files, you must start the libvirt daemon. You can do this by doing:

sudo libvirtd -d

Finaly, to test if libvirt is working, do the following:

virsh -c 'qemu:///system' list --all

This should return an empty list, since no domains have been created yet.

Also, you will need to test if the domifaddr command is working, which is required by the CBTM. You can do this by doing the following:

virsh -c 'qemu:///system' domifaddr

This should throw the error: error: command 'domifaddr' requires <domain> option.

If the command is not recognized, the CBTM will not work properly.



